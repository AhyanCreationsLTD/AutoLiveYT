name: The Challengers Stealth Streamer
on:
  repository_dispatch:
    types: [start_stream]

jobs:
  stream:
    runs-on: ubuntu-latest
    steps:
      - name: Install Professional Tools
        run: sudo apt update && sudo apt install -y ffmpeg curl jq perl

      - name: Execute Stealth Broadcast
        run: |
          # ‡ßß. ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶°‡¶ø‡¶ï‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
          RAW_URL=$(echo "${{ github.event.client_payload.secure_id }}" | base64 --decode)
          
          # ‡ß®. ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ï‡¶∞‡¶æ
          FILE_ID=$(echo $RAW_URL | sed -n 's/.*id=\([^&]*\).*/\1/p')
          if [ -z "$FILE_ID" ]; then
             FILE_ID=$(echo $RAW_URL | sed -n 's/.*\/d\/\([^/]*\).*/\1/p')
          fi

          echo "üéØ Targeting File ID: $FILE_ID"

          # ‡ß©. ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∞ ‡¶≠‡¶æ‡¶á‡¶∞‡¶æ‡¶∏ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶¨‡¶æ‡¶á‡¶™‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶æ (‡¶ñ‡ßÅ‡¶¨‡¶á ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø)
          CONFIRM=$(curl -sc /tmp/gcookie "https://drive.google.com/uc?export=download&id=$FILE_ID" | perl -nle 'print $1 if m{confirm=([0-9A-Za-z_]+)}')
          DIRECT_VIDEO_URL="https://drive.google.com/uc?export=download&confirm=$CONFIRM&id=$FILE_ID"

          echo "üöÄ Signal Bypassed! Starting Stream for The Challengers..."

          # ‡ß™. FFmpeg ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® (‡¶≤‡ßã‡¶ó‡ßã ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶™‡¶ø‡¶∞‡¶æ‡¶á‡¶ü ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡¶π)
          ffmpeg -re -stream_loop -1 -i "$DIRECT_VIDEO_URL" \
            -vf "scale=1280:720,setpts=0.99*PTS,hue=s=1.1:b=0.05,unsharp=3:3:1.5,drawtext=text='THE CHALLENGERS':x=30:y=30:fontsize=24:fontcolor=white@0.5:box=1:boxcolor=black@0.3:boxborderw=5" \
            -af "atempo=1.01,volume=1.2,highpass=f=50,lowpass=f=15000" \
            -c:v libx264 -preset ultrafast -tune zerolatency -b:v 3000k \
            -pix_fmt yuv420p -r 30 -g 60 -map_metadata -1 \
            -c:a aac -b:a 128k -ar 44100 \
            -f flv "rtmp://a.rtmp.youtube.com/live2/${{ secrets.YOUTUBE_STREAM_KEY }}"
            
