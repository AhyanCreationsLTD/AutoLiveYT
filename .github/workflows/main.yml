name: AutoLiveYT Engine V4 - Anti-Copyright & Cookie Mode
on:
  repository_dispatch:
    types: [start_stream]

jobs:
  stream:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Environment
        run: |
          sudo apt update && sudo apt install -y ffmpeg jq
          # yt-dlp ‡¶è‡¶∞ ‡¶≤‡ßá‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶® ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤
          sudo curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp
          sudo chmod a+rx /usr/local/bin/yt-dlp

      - name: Stealth Bypass & Professional Stream
        run: |
          # ‡ßß. ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ GitHub Secrets ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶ï‡¶ø‡¶ú ‡¶®‡¶ø‡ßü‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø
          echo "${{ secrets.YT_COOKIES }}" > cookies.txt
          
          # ‡ß®. ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶°‡¶ø‡¶ï‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
          VIDEO_URL=$(echo "${{ github.event.client_payload.secure_id }}" | base64 --decode)
          
          echo "üöÄ Fetching Direct Link Using Cookies & Stealth Mode..."
          
          # ‡ß©. ‡¶ï‡ßÅ‡¶ï‡¶ø‡¶ú ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßç‡¶∞‡ßü‡ßá‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶ú‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π
          DIRECT_URL=$(yt-dlp --cookies cookies.txt \
            --no-check-certificate \
            --user-agent "Mozilla/5.0 (Linux; Android 14; Pixel 8) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.144 Mobile Safari/537.36" \
            --extractor-args "youtube:player_client=android,web_embedded" \
            -f "bestvideo[height<=720]+bestaudio/best" -g "$VIDEO_URL")
          
          if [ -z "$DIRECT_URL" ]; then
            echo "‚ùå Failed to fetch video link. Check your cookies or link."
            exit 1
          fi

          echo "‚úÖ Link Acquired! Starting Anti-Copyright Rendering..."

          # ‡ß™. FFmpeg ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶∏‡¶ø‡¶ó‡¶®‡ßá‡¶ö‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® (‡¶ï‡¶™‡¶ø‡¶∞‡¶æ‡¶á‡¶ü ‡¶¨‡¶æ‡¶á‡¶™‡¶æ‡¶∏)
          # ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶ø‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶®‡ßü‡ßá‡¶ú, ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶û‡ßç‡¶ú, ‡¶∏‡ßç‡¶™‡¶ø‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶°‡¶ø‡¶ì‡¶∞ ‡¶™‡¶ø‡¶ö ‡¶∂‡¶ø‡¶´‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§
          ffmpeg -re -stream_loop -1 -i "$DIRECT_URL" \
            -vf "scale=1280:720,setpts=0.99*PTS,hue=s=1.1:b=0.1,curves=m='0/0 0.5/0.48 1/1',noise=alls=1:allf=t+u" \
            -af "atempo=1.01,asetrate=44100*0.99,volume=1.1,pan=stereo|c0=c0|c1=c1" \
            -c:v libx264 -preset ultrafast -tune zerolatency -b:v 2500k -maxrate 3000k -bufsize 6000k \
            -map_metadata -1 -metadata title="Original Content" -metadata artist="Owner" \
            -pix_fmt yuv420p -r 30 -g 60 \
            -c:a aac -b:a 128k -ar 44100 \
            -f flv "rtmp://a.rtmp.youtube.com/live2/${{ secrets.YOUTUBE_STREAM_KEY }}"
            
